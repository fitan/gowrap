{{/* gotype: github.com/fitan/gowrap/generator.TemplateInputs */}}
import (
    endpoint "github.com/go-kit/kit/endpoint"
{{range $i := $.Imports}}
    {{$i}}
{{end}}
)

const (
{{range $m := .Interface.Methods}}
	{{$m.Name}}MethodName = "{{$m.Name}}"
{{end}}
)


type Endpoints struct {
{{range $m := $.Interface.Methods}}
    {{$m.Name}}Endpoint endpoint.Endpoint
{{end}}
}

func NewEndpoint(s Service, dmw map[string][]endpoint.Middleware) Endpoints {
	eps := Endpoints{
		{{range $m := $.Interface.Methods}}
		{{$m.Name}}Endpoint: make{{$m.Name}}Endpoint(s),
		{{end}}
	}
	{{range $m := $.Interface.Methods}}
	for _, m := range dmw[{{$m.Name}}MethodName] {
		eps.{{$m.Name}}Endpoint = m(eps.{{$m.Name}}Endpoint)
	}
	{{end}}

	return eps
}

{{range $m := $.Interface.Methods}}
func make{{$m.Name}}Endpoint(s Service) endpoint.Endpoint {
	return func(ctx context.Context, request interface{}) (response interface{}, err error) {
		req := request.({{$m.KitRequest.RequestName}})

		{{range $v := $m.ResultsExcludeErr}}
		var {{$v.Name}} {{$v.Type}}
		{{end}}

		{{$m.ResultsNames}} = s.{{$m.Name}}(
			ctx,
			{{range $v := $m.ParamsExcludeCtx}}req.{{$m.KitRequest.ParamPath $v.Name}},{{end}}
		)
		return {{$m.ResultsMap}}, err
	}
}
{{end}}